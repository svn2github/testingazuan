<project name="SpagoBI" default="create.all" basedir=".">

  <property file="build.properties"/>

  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  <!--   PATH PER ANT-SVN					                                                    -->
  <!-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ --> 
  <!--
  <path id="svnant.classpath">
    <fileset dir="antsvn-lib">
      <include name="**/*.jar"/>
    </fileset>
  </path>
  <taskdef name="svn" classname="org.tigris.subversion.svnant.SvnTask" classpathref="svnant.classpath"/>
  -->
  
  <path id="catalina.ant.classpath">
    <fileset dir="catalina-ant">
      <include name="**/*.jar"/>
    </fileset>
  </path>
  <taskdef name="install"   classname="org.apache.catalina.ant.InstallTask" classpathref="catalina.ant.classpath" />
  <taskdef name="deploy"    classname="org.apache.catalina.ant.DeployTask" classpathref="catalina.ant.classpath" />
  <taskdef name="undeploy"  classname="org.apache.catalina.ant.UndeployTask" classpathref="catalina.ant.classpath" />
  <taskdef name="start"     classname="org.apache.catalina.ant.StartTask" classpathref="catalina.ant.classpath" />
  <taskdef name="stop"      classname="org.apache.catalina.ant.StopTask" classpathref="catalina.ant.classpath" /> 
  <taskdef name="reload"    classname="org.apache.catalina.ant.ReloadTask" classpathref="catalina.ant.classpath" />    
  <taskdef name="remove"    classname="org.apache.catalina.ant.RemoveTask" classpathref="catalina.ant.classpath" />	
  
  <target name="create.SpagoBI.war" >
    <ant dir="../SpagoBIProject/ant" />
  </target>
  <target name="deploy.SpagoBI.war" depends="create.SpagoBI.war,create.exo.security.jar,create.xlm.security.jar">
    <delete dir="${tomcat.home}/webapps/SpagoBI" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBI" />
    <unzip src="../../../SpagoBIProject/dist/SpagoBI/SpagoBI.war" dest="${tomcat.home}/webapps/SpagoBI" />
    <!--
    <copy todir="${tomcat.home}/webapps/SpagoBI/WEB-INF/conf" filtering="true" overwrite="true">
      <fileset dir="${tomcat.home}/webapps/SpagoBI/WEB-INF/conf" />
    </copy>
    -->
    <!--
    <stop url="${manager.url}" username="${username}" password="${password}" path="/SpagoBI"/>
    <undeploy url="${manager.url}" username="${username}" password="${password}" path="/SpagoBI"/>
    <deploy url="${manager.url}" username="${username}" password="${password}" path="/SpagoBI"
               war="file:${dist}/SpagoBI/SpagoBI.war"/>  
    <start url="${manager.url}" username="${username}" password="${password}" path="/SpagoBI"/>
    -->
    <!-- deletes any previuos sbi.security.exo -->
    <delete>
      <fileset dir="${tomcat.home}/webapps/SpagoBI/WEB-INF/lib" includes="**/sbi.security.exo*.jar"/>
      <fileset dir="${tomcat.home}/webapps/SpagoBI/WEB-INF/lib" includes="**/sbi.security.xml*.jar"/>
    </delete>
    <!-- copies the newly created jar file -->
    <copy file="../../../SpagoBIExoSecurityProvider/dist/SpagoBIExoSecurityProvider/sbi.security.exo-${project.version}.jar" 
        todir="${tomcat.home}/webapps/SpagoBI/WEB-INF/lib" overwrite="true" />
    <copy file="../../../SpagoBIXMLSecurityProvider/dist/SpagoBIXMLSecurityProvider/sbi.security.xml-${project.version}.jar" 
        todir="${tomcat.home}/webapps/SpagoBI/WEB-INF/lib" overwrite="true" />
  </target>

  <target name="create.sbi.utils.jar" >
    <ant dir="../SpagoBIUtils/ant" />
  </target>
  
  <target name="create.exo.security.jar" >
    <ant dir="../SpagoBIExoSecurityProvider/ant" />
  </target>
  <target name="create.xlm.security.jar" >
    <ant dir="../SpagoBIXmlSecurityProvider/ant" />
  </target>
  
  <target name="create.SpagoBIBirtReportEngine.war" >
    <ant dir="../SpagoBIBirtReportEngine/ant" />
  </target>
  <target name="deploy.SpagoBIBirtReportEngine.war" depends="create.sbi.utils.jar,create.SpagoBIBirtReportEngine.war">
    <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIBirtReportEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIBirtReportEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIBirtReportEngine" />
    <unzip src="../../../SpagoBIBirtReportEngine/dist/SpagoBIBirtReportEngine/SpagoBIBirtReportEngine.war" dest="${tomcat.home}/webapps/SpagoBIBirtReportEngine" />
  </target>
  
  <target name="create.SpagoBIGeoEngine.war" >
    <ant dir="../SpagoBIGeoEngine/ant" />
  </target>
  <target name="deploy.SpagoBIGeoEngine.war" depends="create.sbi.utils.jar,create.SpagoBIGeoEngine.war">
  <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIGeoEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIGeoEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIGeoEngine" />
    <unzip src="../../../SpagoBIGeoEngine/dist/SpagoBIGeoEngine/SpagoBIGeoEngine.war" dest="${tomcat.home}/webapps/SpagoBIGeoEngine" />
  </target>
  
  <target name="create.SpagoBIJasperReportEngine.war" >
    <ant dir="../SpagoBIJasperReportEngine/ant" />
  </target>
  <target name="deploy.SpagoBIJasperReportEngine.war" depends="create.sbi.utils.jar,create.SpagoBIJasperReportEngine.war">
    <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIJasperReportEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIJasperReportEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIJasperReportEngine" />
    <unzip src="../../../SpagoBIJasperReportEngine/dist/SpagoBIJasperReportEngine/SpagoBIJasperReportEngine.war" dest="${tomcat.home}/webapps/SpagoBIJasperReportEngine" />
  </target>
  
  <target name="create.SpagoBIJPaloEngine.war" >
    <ant dir="../SpagoBIJPaloEngine/ant" />
  </target>
  <target name="deploy.SpagoBIJPaloEngine.war" depends="create.sbi.utils.jar,create.SpagoBIJPaloEngine.war">
    <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIJPaloEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIJPaloEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIJPaloEngine" />
    <unzip src="../../../SpagoBIJPaloEngine/dist/SpagoBIJPaloEngine/SpagoBIJPaloEngine.war" dest="${tomcat.home}/webapps/SpagoBIJPaloEngine" />
  </target>
  
  <target name="create.SpagoBIJPivotEngine.war" >
    <ant dir="../SpagoBIJPivotEngine/ant" />
  </target>
  <target name="deploy.SpagoBIJPivotEngine.war" depends="create.sbi.utils.jar,create.SpagoBIJPivotEngine.war">
  <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIJPivotEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIJPivotEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIJPivotEngine" />
    <unzip src="../../../SpagoBIJPivotEngine/dist/SpagoBIJPivotEngine/SpagoBIJPivotEngine.war" dest="${tomcat.home}/webapps/SpagoBIJPivotEngine" />
  </target>

  <target name="create.qbe.core.jar" >
    <ant dir="../QbeCore/ant" />
  </target>
  <target name="create.SpagoBIQbeEngine.war" >
    <ant dir="../SpagoBIQbeEngine/ant" />
  </target>
  <target name="deploy.SpagoBIQbeEngine.war" depends="create.sbi.utils.jar,create.qbe.core.jar,create.SpagoBIQbeEngine.war">
    <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIQbeEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIQbeEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIQbeEngine" />
    <unzip src="../../../SpagoBIQbeEngine/dist/SpagoBIQbeEngine/SpagoBIQbeEngine.war" dest="${tomcat.home}/webapps/SpagoBIQbeEngine" />
  </target>
  
  <target name="create.SpagoBITalendEngine.war" >
    <ant dir="../SpagoBITalendEngine/ant" />
  </target>
  <target name="deploy.SpagoBITalendEngine.war" depends="create.sbi.utils.jar,create.SpagoBITalendEngine.war">
  <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBITalendEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBITalendEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBITalendEngine" />
    <unzip src="../../../SpagoBITalendEngine/dist/SpagoBITalendEngine/SpagoBITalendEngine.war" dest="${tomcat.home}/webapps/SpagoBITalendEngine" />
  </target>
  
  <target name="create.SpagoBIWekaEngine.war" >
    <ant dir="../SpagoBIWekaEngine/ant" />
  </target>
  <target name="deploy.SpagoBIWekaEngine.war" depends="create.sbi.utils.jar,create.SpagoBIWekaEngine.war">
  <delete dir="${tomcat.home}/work/Catalina/localhost/SpagoBIWekaEngine" />
    <delete dir="${tomcat.home}/webapps/SpagoBIWekaEngine" />
    <mkdir dir="${tomcat.home}/webapps/SpagoBIWekaEngine" />
    <unzip src="../../../SpagoBIWekaEngine/dist/SpagoBIWekaEngine/SpagoBIWekaEngine.war" dest="${tomcat.home}/webapps/SpagoBIWekaEngine" />
  </target>
  
  <target name="create.all" >
    <!--  
    Dependencies between projects:
    SpagoBI is the root, must be compiled first
    sbi.utils depends on SpagoBI
    exo.security depends on SpagoBI
    engines (apart from SpagoBIQbeEngine) depends on sbi.utils
    qbe.core depends on sbi.utils
    SpagoBIQbeEngine depends on qbe.core and sbi.utils
    -->
    <antcall target="create.SpagoBI.war" />
    <antcall target="create.sbi.utils.jar" />
    <antcall target="create.exo.security.jar" />
    <antcall target="create.xlm.security.jar" />
    <antcall target="create.SpagoBIBirtReportEngine.war" />
    <antcall target="create.SpagoBIGeoEngine.war" />
    <antcall target="create.SpagoBIJasperReportEngine.war" />
    <antcall target="create.SpagoBIJPaloEngine.war" />
    <antcall target="create.SpagoBIJPivotEngine.war" />
    <antcall target="create.qbe.core.jar" />
    <antcall target="create.SpagoBIQbeEngine.war" />
    <antcall target="create.SpagoBITalendEngine.war" />
    <antcall target="create.SpagoBIWekaEngine.war" />
  </target>

  <target name="deploy.all" >
    <antcall target="deploy.SpagoBI.war" />
    <antcall target="deploy.SpagoBIBirtReportEngine.war" />
    <antcall target="deploy.SpagoBIGeoEngine.war" />
    <antcall target="deploy.SpagoBIJasperReportEngine.war" />
    <antcall target="deploy.SpagoBIJPaloEngine.war" />
    <antcall target="deploy.SpagoBIJPivotEngine.war" />
    <antcall target="deploy.SpagoBIQbeEngine.war" />
    <antcall target="deploy.SpagoBITalendEngine.war" />
    <antcall target="deploy.SpagoBIWekaEngine.war" />
  </target>

   <target name="clean.all" >
    	<delete dir="../dist"/>
	<delete dir="../QbeCore/ant-build"/>
	<delete dir="../SpagoBIBirtReportEngine/ant-build"/>
	<delete dir="../SpagoBIExoSecurityProvider/ant-build"/>
	<delete dir="../SpagoBIGeoReportEngine/ant-build"/>
       <delete dir="../SpagoBIJasperReportReportEngine/ant-build"/>
<delete dir="../SpagoBIJPaloEngine/ant-build"/>
<delete dir="../SpagoBIJPivotEngine/ant-build"/>
<delete dir="../SpagoBIQbeEngine/ant-build"/>
<delete dir="../SpagoBITalendEngine/ant-build"/>
<delete dir="../SpagoBIProject/ant-build"/>
<delete dir="../SpagoBIUtils/ant-build"/>
<delete dir="../SpagoBIWekaEngine/ant-build"/>
	
   </target>
   
  <target name="copy.ss" >
    <copy todir="${apache.dir}/js" >
      <fileset dir="/home/spagobi/runtime/exo-tomcat-portal-1.1.4/webapps/SpagoBI/js">
      </fileset>
    </copy>
    <copy todir="${apache.dir}/css" >
      <fileset dir="/home/spagobi/runtime/exo-tomcat-portal-1.1.4/webapps/SpagoBI/css">
      </fileset>
    </copy>
    <copy todir="${apache.dir}/img" >
      <fileset dir="/home/spagobi/runtime/exo-tomcat-portal-1.1.4/webapps/SpagoBI/img">
      </fileset>
    </copy>
    <copy todir="${apache.dir}/html" >
      <fileset dir="/home/spagobi/runtime/exo-tomcat-portal-1.1.4/webapps/SpagoBI/html">
      </fileset>
    </copy>    
  </target>
  
</project>
